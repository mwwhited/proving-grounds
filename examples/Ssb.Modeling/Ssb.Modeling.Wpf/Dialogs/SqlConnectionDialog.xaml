<Window xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:m="clr-namespace:Ssb.Modeling.Wpf.Models" 
        xmlns:c="clr-namespace:Ssb.Modeling.Wpf.Converters" 
        
        x:Class="Ssb.Modeling.Wpf.Dialogs.SqlConnectionDialog"
        x:Name="_sqlConnectionDialog"
        
        Title="SQL Server Connection" 
        
        SizeToContent="WidthAndHeight" 
        ResizeMode="NoResize" 
        ShowInTaskbar="False" 
        WindowStartupLocation="CenterOwner"
        >
    <Window.DataContext>
        <m:SqlConnectionModel/>
    </Window.DataContext>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <TextBlock Grid.Row="0" Text="Instance Name" />

        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <ComboBox Grid.Column="0" IsEditable="True" Text="{Binding ServerName}"
                      ItemsSource="{Binding Instances}"/>
            <Button Grid.Column="1" Content="Refresh" Command="{Binding RefreshInstances}" CommandParameter="{Binding ElementName=_sqlConnectionDialog}" />
        </Grid>

        <GroupBox Grid.Row="2" Header="Log on to the server">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>
                <RadioButton Grid.Row="0" Grid.ColumnSpan="2" GroupName="LogonType" Content="Use Windows Authentication" IsChecked="True" />
                <RadioButton Grid.Row="1" Grid.ColumnSpan="2" GroupName="LogonType" Content="Use SQL Server Authentication" IsChecked="{Binding UseSqlAuthentication}" />
                <TextBlock Grid.Row="2" Text="User" />
                <TextBox Grid.Row="2" Grid.Column="1" Text="{Binding UserName,Mode=TwoWay}" IsEnabled="{Binding UseSqlAuthentication}" />
                <TextBlock Grid.Row="3" Text="Password" Margin="0,0,2,0" />
                <PasswordBox Grid.Row="3" Grid.Column="1" 
                             c:PasswordHelper.Attach="True"
                             c:PasswordHelper.Password="{Binding Password,Mode=TwoWay}"
                             IsEnabled="{Binding UseSqlAuthentication}"  />
            </Grid>
        </GroupBox>

        <GroupBox Grid.Row="3" Header="Connect to database">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>
                <TextBlock Grid.Row="0" Text="Select or enter a database name" />
                <Grid Grid.Row="1">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>


                    <ComboBox Grid.Column="0" IsEditable="True" Text="{Binding Database}"
                              ItemsSource="{Binding Databases}" />
                    <Button Grid.Column="1" Content="Refresh" Command="{Binding RefreshDatabases}" CommandParameter="{Binding ElementName=_sqlConnectionDialog}" />
                </Grid>
            </Grid>
        </GroupBox>

        <Grid Grid.Row="4">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>
            <Button Grid.Column="0" Content="OK" Command="{Binding Okay}" CommandParameter="{Binding ElementName=_sqlConnectionDialog}" IsDefault="True" ToolTip="{Binding ConnectionString, Mode=OneWay}" />
            <Button Grid.Column="1" Content="Cancel" Command="{Binding Cancel}" CommandParameter="{Binding ElementName=_sqlConnectionDialog}" IsDefault="True" />
            <Button Grid.Column="3" Content="Test" Command="{Binding Test}" CommandParameter="{Binding ElementName=_sqlConnectionDialog}" />
        </Grid>

        <TextBox Grid.Row="5" Grid.ColumnSpan="2" Text="{Binding Status}" IsReadOnly="False" Width="275" AcceptsReturn="True" AcceptsTab="True" TextWrapping="WrapWithOverflow" />
    </Grid>
</Window>
